<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>App de Pedidos - DOG√ÉO PRE√Å</title>
    
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- √çcones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* --- VARIAVEIS & RESET --- */
        :root {
            --primary: #ff9f1c;
            --primary-dark: #e08b15;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --text-light: #f3f4f6;
            --text-gray: #9ca3af;
            --whatsapp: #25D366;
            --danger: #ff4444;
            --info-bg: rgba(59, 130, 246, 0.15);
            --info-text: #60a5fa;
            --ai-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
            padding-bottom: 80px; /* Espa√ßo para o carrinho flutuante */
        }

        h1, h2, h3, .brand-font {
            font-family: 'Bebas Neue', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- UTILITARIOS --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .btn { cursor: pointer; border: none; outline: none; transition: 0.2s; font-weight: 700; border-radius: 50px; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background-color: var(--primary); color: #000; padding: 10px 25px; }
        .btn-primary:hover { background-color: var(--primary-dark); transform: translateY(-2px); }
        
        /* --- HEADER --- */
        header {
            background-color: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #333;
            padding: 15px 0;
        }
        .nav-flex { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; color: var(--primary); }
        
        .header-actions { display: flex; gap: 10px; }
        .icon-btn { background: transparent; color: #fff; border: 1px solid #444; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .icon-btn:hover { background: #333; border-color: #666; }

        /* --- BARRA DE BUSCA --- */
        .search-container {
            margin-top: 20px;
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
        }
        .search-box {
            width: 100%;
            background-color: #2d2d2d;
            border: 1px solid #444;
            border-radius: 50px;
            padding: 12px 20px;
            color: #fff;
            font-size: 16px;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }
        .search-box:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(255, 159, 28, 0.2);
        }
        .search-input {
            background: transparent;
            border: none;
            color: #fff;
            width: 100%;
            font-size: 16px;
            outline: none;
        }
        .search-icon { color: var(--text-gray); }

        /* Bot√£o M√°gico AI */
        .ai-btn {
            background: var(--ai-gradient);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(118, 75, 162, 0.5);
            transition: transform 0.3s;
            font-size: 20px;
        }
        .ai-btn:hover { transform: scale(1.1) rotate(10deg); }

        /* Aviso de busca (oculto por padr√£o) */
        .search-helper {
            margin-top: 10px;
            background-color: var(--info-bg);
            color: var(--info-text);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--info-text);
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CATEGORIAS --- */
        .category-nav {
            position: sticky;
            top: 60px; /* Logo abaixo do header */
            background-color: var(--bg-dark);
            z-index: 90;
            padding: 15px 0;
            overflow-x: auto;
            white-space: nowrap;
            border-bottom: 1px solid #333;
        }
        .category-list { display: flex; gap: 10px; padding: 0 20px; list-style: none; }
        .cat-btn {
            background: #2d2d2d; border: 1px solid #444; color: #fff;
            padding: 8px 20px; border-radius: 20px; font-size: 14px; font-weight: 600;
        }
        .cat-btn.active { background: var(--primary); color: #000; border-color: var(--primary); }

        /* --- GRID DE PRODUTOS --- */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .menu-item {
            background-color: var(--bg-card);
            border-radius: 12px;
            border: 1px solid #333;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .item-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .item-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .item-title { font-weight: 700; font-size: 18px; color: #fff; }
        .item-price { color: var(--primary); font-weight: 700; font-size: 18px; }
        .item-desc { font-size: 13px; color: var(--text-gray); margin-bottom: 15px; flex-grow: 1; }
        
        /* Bot√µes de A√ß√£o (Adicionar e Qty) */
        .btn-container {
            margin-top: auto;
            height: 46px; /* Altura fixa para evitar pulos de layout */
        }

        .add-btn {
            width: 100%; height: 100%; background: #2d2d2d; color: #fff; 
            border-radius: 8px; font-weight: 600; border: 1px solid #444;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            cursor: pointer; transition: 0.2s;
        }
        .add-btn:hover { background: var(--primary); color: #000; border-color: var(--primary); }

        .qty-selector {
            display: flex; align-items: center; justify-content: space-between;
            background-color: #252525; border-radius: 8px; border: 1px solid var(--primary);
            width: 100%; height: 100%; padding: 0 5px;
        }
        .qty-selector button {
            width: 40px; height: 100%; background: transparent; color: #fff;
            border: none; font-size: 16px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .qty-selector button:active { transform: scale(0.9); }
        .qty-selector button:hover { color: var(--primary); }
        .qty-selector span { color: var(--primary); font-weight: 800; font-size: 18px; }

        /* --- CARRINHO FLUTUANTE (FAB) --- */
        .floating-cart {
            position: fixed;
            bottom: 20px;
            right: 20px;
            left: 20px;
            background-color: var(--primary);
            color: #000;
            padding: 15px 25px;
            border-radius: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.3s;
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .floating-cart:active { transform: scale(0.95); }
        .cart-count { background: #000; color: var(--primary); padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 5px; }
        .hidden { display: none !important; }

        @keyframes popUp { from { transform: translateY(100px); } to { transform: translateY(0); } }

        /* --- MODAL GENERICO --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000;
            display: flex; justify-content: center; align-items: flex-end;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        
        .modal-content {
            background: var(--bg-card);
            width: 100%; max-width: 600px;
            height: 90vh; /* Sheet style */
            border-radius: 20px 20px 0 0;
            padding: 25px;
            display: flex; flex-direction: column;
            transform: translateY(100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        .modal-overlay.open .modal-content { transform: translateY(0); }

        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .close-modal { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }

        /* --- ESTILOS DO CHECKOUT --- */
        .cart-items { margin-bottom: 20px; }
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: #252525; padding: 10px; border-radius: 8px; }
        .cart-item-info h4 { font-size: 14px; color: #fff; }
        .cart-item-info span { font-size: 12px; color: var(--primary); }
        .qty-controls { display: flex; align-items: center; gap: 10px; }
        .qty-btn { background: #333; color: #fff; width: 25px; height: 25px; border-radius: 50%; border: none; cursor: pointer; }
        
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-size: 14px; color: #aaa; }
        .form-input, .form-select { 
            width: 100%; padding: 12px; background: #121212; border: 1px solid #333; 
            color: #fff; border-radius: 8px; font-family: inherit; font-size: 16px;
        }
        .form-input:focus { border-color: var(--primary); outline: none; }

        .radio-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .radio-option {
            flex: 1; position: relative;
        }
        .radio-option input { display: none; }
        .radio-option label {
            display: block; padding: 10px; text-align: center; background: #252525; 
            border: 1px solid #444; border-radius: 8px; cursor: pointer; font-size: 13px; transition: 0.2s;
        }
        .radio-option input:checked + label { background: var(--primary); color: #000; border-color: var(--primary); font-weight: 700; }

        .geo-btn {
            background: #25D366; color: #fff; width: 100%; margin-top: 10px;
            border: none; padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .geo-status { font-size: 12px; color: #aaa; margin-top: 5px; text-align: center; }
        .geo-success { color: var(--whatsapp); }

        .delivery-fee-notice {
            background-color: rgba(255, 159, 28, 0.15);
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cart-total { font-size: 24px; color: var(--primary); text-align: right; margin: 20px 0; border-top: 1px solid #333; padding-top: 15px; }
        
        .btn-whatsapp { width: 100%; background: var(--whatsapp); color: #fff; padding: 15px; border-radius: 10px; font-size: 18px; }

        /* --- CHAT AI --- */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            background: #151515;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .message { padding: 10px; border-radius: 8px; max-width: 80%; font-size: 14px; line-height: 1.4; }
        .message.bot { background: #2d2d2d; color: #ddd; align-self: flex-start; border-left: 3px solid var(--primary); }
        .message.user { background: var(--primary); color: #000; align-self: flex-end; font-weight: 500; }
        .input-area { display: flex; gap: 10px; }
        .chat-btn { background: var(--ai-gradient); color: white; border: none; width: 45px; height: 45px; border-radius: 8px; cursor: pointer; }
        .typing-indicator { font-size: 12px; color: #888; font-style: italic; margin-left: 10px; display: none; }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container nav-flex">
            <div class="logo brand-font">DOG√ÉO PRE√Å</div>
        </div>
    </header>

    <div class="container">
        <!-- Barra de Busca + Bot√£o M√°gico -->
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="search-input" placeholder="O que procuras hoje?" oninput="searchProducts(this.value)">
            </div>
            <button class="ai-btn" onclick="toggleChefBot()" title="Falar com Chef Dog√£o">
                <i class="fas fa-comment-dots"></i>
            </button>
        </div>
        <!-- Aviso de Busca (Din√¢mico) -->
        <div id="search-helper" class="search-helper hidden">
            <i class="fas fa-info-circle"></i>
            <span>Marcas e sabores ser√£o combinados no WhatsApp ap√≥s o pedido.</span>
        </div>
    </div>

    <!-- Navega√ß√£o Categorias -->
    <nav class="category-nav">
        <ul class="category-list" id="category-list">
            <!-- Preenchido via JS -->
        </ul>
    </nav>

    <!-- Conte√∫do Principal -->
    <div class="container">
        <div id="menu-container">
            <!-- Preenchido via JS -->
        </div>
    </div>

    <!-- Bot√£o Flutuante do Carrinho -->
    <div id="floating-cart" class="floating-cart hidden" onclick="toggleCart()">
        <span><i class="fas fa-shopping-bag"></i> Ver Sacola <span id="cart-count" class="cart-count">0</span></span>
        <span id="cart-total-float">R$ 0,00</span>
    </div>

    <!-- Modal de Checkout -->
    <div class="modal-overlay" id="cart-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="brand-font">Seu Pedido</h2>
                <button class="close-modal" onclick="toggleCart()"><i class="fas fa-times"></i></button>
            </div>
            <div id="cart-items" class="cart-items"><p style="text-align: center; color: #666;">Seu carrinho est√° vazio.</p></div>
            <div class="cart-total brand-font" id="modal-total">R$ 0,00</div>
            <div id="checkout-form" style="display: none;">
                <h3 class="brand-font" style="margin-bottom: 15px; color: var(--primary);">Dados para Entrega</h3>
                <div class="form-group"><label class="form-label">Seu Nome*</label><input type="text" id="customer-name" class="form-input" placeholder="Ex: Jo√£o da Silva"></div>
                <div class="form-group"><label class="form-label">Tipo de Pedido*</label>
                    <div class="radio-group">
                        <div class="radio-option"><input type="radio" name="orderType" id="type-delivery" value="Entrega" onchange="toggleAddressField(true)"><label for="type-delivery"><i class="fas fa-motorcycle"></i> Entrega</label></div>
                        <div class="radio-option"><input type="radio" name="orderType" id="type-pickup" value="Retirada" onchange="toggleAddressField(false)"><label for="type-pickup"><i class="fas fa-box"></i> Retirada</label></div>
                        <div class="radio-option"><input type="radio" name="orderType" id="type-eatin" value="Mesa" onchange="toggleAddressField(false)"><label for="type-eatin"><i class="fas fa-utensils"></i> Mesa</label></div>
                    </div>
                </div>
                <div id="address-section" class="form-group hidden">
                    <div class="delivery-fee-notice"><i class="fas fa-info-circle"></i><span>A taxa de entrega ser√° calculada e informada no WhatsApp ap√≥s o envio do pedido.</span></div>
                    <label class="form-label">Localiza√ß√£o*</label><button type="button" class="geo-btn" onclick="getLocation()"><i class="fas fa-map-marker-alt"></i> Usar Localiza√ß√£o Atual (GPS)</button><div id="geo-status" class="geo-status"></div>
                    <label class="form-label" style="margin-top: 10px;">Ou digite o endere√ßo/ponto de refer√™ncia:</label><textarea id="address-text" class="form-input" rows="2" placeholder="Rua, N√∫mero, Bairro..."></textarea><input type="hidden" id="maps-link">
                </div>
                <div class="form-group"><label class="form-label">Forma de Pagamento*</label>
                    <select id="payment-method" class="form-select"><option value="PIX">PIX</option><option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option><option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option><option value="Dinheiro">Dinheiro (Precisa de troco?)</option></select>
                </div>
                <button class="btn btn-whatsapp" onclick="finalizeOrder()"><i class="fab fa-whatsapp"></i> ENVIAR PEDIDO</button>
            </div>
        </div>
    </div>

    <!-- Modal Chef Bot IA (Agora Offline) -->
    <div class="modal-overlay" id="chef-bot-modal">
        <div class="modal-content" style="height: 80vh;">
            <div class="modal-header">
                <h2 class="brand-font" style="color: #8e9eab; background: var(--ai-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Chef Dog√£o Virtual ‚ú®</h2>
                <button class="close-modal" onclick="toggleChefBot()"><i class="fas fa-times"></i></button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message bot">Ol√°! Sou o Chef Dog√£o ü§ñ. N√£o sabes o que pedir? Diz-me se tens muita fome ou diz "Card√°pio" para ver op√ß√µes! üçî</div>
            </div>
            <div class="typing-indicator" id="typing-indicator">Chef Dog√£o est√° a pensar...</div>
            <div class="input-area">
                <input type="text" id="chat-input" class="form-input" placeholder="Ex: Quero algo com bacon..." onkeypress="handleChatKey(event)">
                <button class="chat-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS DO CARD√ÅPIO ---
        const menuData = [
            { id: 1, name: "Queijo e Ovos", price: 10.00, category: "sanduiches", desc: "P√£o, queijo e ovos." },
            { id: 2, name: "Hamb√∫rguer", price: 10.00, category: "sanduiches", desc: "P√£o, carne de hamb√∫rguer e salada." },
            { id: 3, name: "Misto Quente", price: 10.00, category: "sanduiches", desc: "P√£o, queijo e presunto." },
            { id: 4, name: "X-Burguer", price: 12.00, category: "sanduiches", desc: "P√£o, carne de hamb√∫rguer e queijo." },
            { id: 5, name: "Frango Simples", price: 12.00, category: "sanduiches", desc: "P√£o, frango, queijo, salada e milho verde." },
            { id: 6, name: "Calabresa Simples", price: 12.00, category: "sanduiches", desc: "P√£o, calabresa, queijo e salada." },
            { id: 7, name: "Americano", price: 12.00, category: "sanduiches", desc: "P√£o, queijo, presunto, ovos e salada." },
            { id: 8, name: "X-Salada", price: 12.00, category: "sanduiches", desc: "P√£o, carne de hamb√∫rguer, queijo e salada." },
            { id: 9, name: "Baur√∫", price: 14.00, category: "sanduiches", desc: "P√£o, carne, queijo, presunto e salada." },
            { id: 10, name: "X-Egg", price: 14.00, category: "sanduiches", desc: "P√£o, carne, queijo, ovos e salada." },
            { id: 11, name: "X-Calabresa", price: 14.00, category: "sanduiches", desc: "P√£o, carne, queijo, calabresa e salada." },
            { id: 12, name: "X-Frango", price: 14.00, category: "sanduiches", desc: "P√£o, carne, queijo, frango e salada." },
            { id: 13, name: "X-Bacon", price: 15.00, category: "sanduiches", desc: "P√£o, carne, queijo, bacon e salada." },
            { id: 14, name: "X-Frango Bacon", price: 15.00, category: "sanduiches", desc: "P√£o, carne, queijo, frango, bacon e salada." },
            { id: 15, name: "X-Tudo", price: 18.00, category: "especiais", desc: "P√£o, carne, queijo, frango, presunto, ovos, bacon e salada." },
            { id: 16, name: "Sandubob", price: 16.00, category: "especiais", desc: "P√£o √°rabe, 2 carnes, queijo, ovos e salada." },
            { id: 17, name: "Dog√£o (P√£o √Årabe)", price: 18.00, category: "especiais", desc: "P√£o √°rabe, carne caseira, queijo, frango, bacon, calabresa, salada." },
            { id: 18, name: "Lanch√£o (P√£o √Årabe)", price: 18.00, category: "especiais", desc: "P√£o √°rabe, carne, queijo, frango, ovos, bacon, salada." },
            { id: 19, name: "Hot-Dog Simples", price: 12.00, category: "hotdogs", desc: "P√£o, molho carne, salsicha, salada, batata, milho." },
            { id: 20, name: "Hot-Scooby", price: 14.00, category: "hotdogs", desc: "P√£o, molho carne, 2 salsichas, salada, batata, milho, queijo." },
            { id: 21, name: "Pastel Misto (P)", price: 10.00, category: "pasteis", desc: "Tamanho Pequeno." },
            { id: 22, name: "Pastel Misto (G)", price: 12.00, category: "pasteis", desc: "Tamanho Grande." },
            { id: 23, name: "Pastel Queijo (P)", price: 10.00, category: "pasteis", desc: "Tamanho Pequeno." },
            { id: 24, name: "Pastel Queijo (G)", price: 12.00, category: "pasteis", desc: "Tamanho Grande." },
            { id: 25, name: "Pastel Carne (P)", price: 12.00, category: "pasteis", desc: "Tamanho Pequeno." },
            { id: 26, name: "Pastel Carne (G)", price: 14.00, category: "pasteis", desc: "Tamanho Grande." },
            { id: 27, name: "Pastel Frango/Queijo (P)", price: 12.00, category: "pasteis", desc: "Tamanho Pequeno." },
            { id: 28, name: "Pastel Frango/Queijo (G)", price: 14.00, category: "pasteis", desc: "Tamanho Grande." },
            { id: 29, name: "Batata Frita (P)", price: 15.00, category: "bebidas", desc: "Por√ß√£o Pequena." },
            { id: 30, name: "Batata Frita (G)", price: 20.00, category: "bebidas", desc: "Por√ß√£o Grande." },
            { id: 31, name: "Batata Recheada", price: 35.00, category: "bebidas", desc: "Batata frita, bacon e calabresa." },
            { id: 32, name: "Sucos Naturais", price: 0.00, category: "bebidas", desc: "Valores a consultar." },
            { id: 33, name: "Refrigerante Lata", price: 0.00, category: "bebidas", desc: "350ml. Sabor a combinar.", keywords: ["coca", "cola", "fanta", "guarana", "guaran√°", "pepsi", "sprite", "sukita", "kuat", "soda", "antarctica"] },
            { id: 34, name: "Refrigerante 1 Litro", price: 0.00, category: "bebidas", desc: "Sabor a combinar.", keywords: ["coca", "cola", "fanta", "guarana", "guaran√°", "pepsi", "sprite", "sukita", "kuat", "soda", "antarctica"] },
            { id: 35, name: "Refrigerante 1.5 Litros", price: 0.00, category: "bebidas", desc: "Sabor a combinar.", keywords: ["coca", "cola", "fanta", "guarana", "guaran√°", "pepsi", "sprite", "sukita", "kuat", "soda", "antarctica"] },
            { id: 36, name: "Refrigerante 2 Litros", price: 0.00, category: "bebidas", desc: "Sabor a combinar.", keywords: ["coca", "cola", "fanta", "guarana", "guaran√°", "pepsi", "sprite", "sukita", "kuat", "soda", "antarctica"] }
        ];

        const categories = [
            { id: 'sanduiches', label: 'Sandu√≠ches' },
            { id: 'especiais', label: 'Especiais' },
            { id: 'hotdogs', label: 'Hot Dogs' },
            { id: 'pasteis', label: 'Past√©is' },
            { id: 'bebidas', label: 'Acompanhamentos' }
        ];

        let cart = [];

        window.onload = () => {
            renderCategories();
            renderMenu();
        };

        function renderCategories() {
            const list = document.getElementById('category-list');
            list.innerHTML = `<li><button class="cat-btn active" onclick="filterMenu('all', this)">Todos</button></li>` + 
                categories.map(c => `<li><button class="cat-btn" onclick="filterMenu('${c.id}', this)">${c.label}</button></li>`).join('');
        }

        function getButtonHtml(id) {
            const itemInCart = cart.find(i => i.id === id);
            if (itemInCart) {
                return `<div class="qty-selector"><button onclick="updateQty(${id}, -1)"><i class="fas fa-minus"></i></button><span>${itemInCart.qty}</span><button onclick="updateQty(${id}, 1)"><i class="fas fa-plus"></i></button></div>`;
            } else {
                return `<button class="add-btn" onclick="addToCart(${id})">ADICIONAR <i class="fas fa-plus"></i></button>`;
            }
        }

        function searchProducts(query) {
            const term = query.toLowerCase().trim();
            const catButtons = document.querySelectorAll('.cat-btn');
            const helper = document.getElementById('search-helper');
            const sodaBrands = ["coca", "cola", "fanta", "guarana", "guaran√°", "pepsi", "sprite", "sukita", "kuat", "soda", "antarctica", "refri"];
            const isSodaSearch = sodaBrands.some(brand => term.includes(brand));

            if(isSodaSearch) helper.classList.remove('hidden');
            else helper.classList.add('hidden');
            
            if (term.length > 0) {
                catButtons.forEach(btn => btn.classList.remove('active'));
                const filtered = menuData.filter(item => {
                    const nameMatch = item.name.toLowerCase().includes(term);
                    const descMatch = item.desc.toLowerCase().includes(term);
                    const keywordMatch = item.keywords ? item.keywords.some(k => k.includes(term)) : false;
                    return nameMatch || descMatch || keywordMatch;
                });
                renderGrid(filtered, term);
            } else {
                helper.classList.add('hidden');
                filterMenu('all', document.querySelector('.cat-btn'));
            }
        }

        function renderGrid(items, searchTerm = '') {
            const container = document.getElementById('menu-container');
            if (items.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: 40px; color: #aaa;"><i class="fas fa-search" style="font-size: 40px; margin-bottom: 10px;"></i><p>Nenhum produto encontrado para "${searchTerm}"</p></div>`;
                return;
            }
            container.innerHTML = `<div class="menu-grid">${items.map(item => {
                const priceDisplay = item.price > 0 ? `R$ ${item.price.toFixed(2).replace('.',',')}` : "Consultar";
                return `<div class="menu-item"><div class="item-content"><div class="item-header"><span class="item-title">${item.name}</span><span class="item-price">${priceDisplay}</span></div><p class="item-desc">${item.desc}</p><div class="btn-container" id="btn-container-${item.id}">${getButtonHtml(item.id)}</div></div></div>`
            }).join('')}</div>`;
        }

        function renderMenu(filter = 'all') {
            document.getElementById('search-input').value = '';
            document.getElementById('search-helper').classList.add('hidden');
            const itemsToShow = filter === 'all' ? menuData : menuData.filter(i => i.category === filter);
            renderGrid(itemsToShow);
        }

        function filterMenu(catId, btnElement) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            if (btnElement) btnElement.classList.add('active');
            renderMenu(catId);
        }

        function addToCart(id) {
            const item = menuData.find(i => i.id === id);
            const existing = cart.find(i => i.id === id);
            if (existing) existing.qty++;
            else cart.push({ ...item, qty: 1 });
            updateGridButton(id);
            updateCartUI();
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function updateQty(id, change) {
            const itemIndex = cart.findIndex(i => i.id === id);
            if (itemIndex > -1) {
                cart[itemIndex].qty += change;
                if (cart[itemIndex].qty <= 0) cart.splice(itemIndex, 1);
            }
            updateGridButton(id);
            updateCartUI();
        }

        function updateGridButton(id) {
            const container = document.getElementById(`btn-container-${id}`);
            if (container) container.innerHTML = getButtonHtml(id);
        }

        function updateCartUI() {
            const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
            const totalPrice = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const floatBtn = document.getElementById('floating-cart');
            document.getElementById('cart-count').innerText = totalQty;
            document.getElementById('cart-total-float').innerText = `R$ ${totalPrice.toFixed(2).replace('.',',')}`;
            
            if (totalQty > 0) {
                floatBtn.classList.remove('hidden');
                document.getElementById('checkout-form').style.display = 'block';
            } else {
                floatBtn.classList.add('hidden');
                document.getElementById('checkout-form').style.display = 'none';
            }
            const list = document.getElementById('cart-items');
            if (cart.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; margin: 20px;">Carrinho vazio...</p>';
            } else {
                list.innerHTML = cart.map(item => {
                    const itemTotal = item.price > 0 ? `R$ ${(item.price * item.qty).toFixed(2).replace('.',',')}` : "A Consultar";
                    return `<div class="cart-item-row"><div class="cart-item-info"><h4>${item.name}</h4><span>${itemTotal}</span></div><div class="qty-controls"><button class="qty-btn" onclick="updateQty(${item.id}, -1)">-</button><span style="color: #fff; font-weight: bold;">${item.qty}</span><button class="qty-btn" onclick="updateQty(${item.id}, 1)">+</button></div></div>`
                }).join('');
            }
            document.getElementById('modal-total').innerText = `Total Estimado: R$ ${totalPrice.toFixed(2).replace('.',',')}`;
        }

        function toggleCart() {
            document.getElementById('cart-modal').classList.toggle('open');
        }
        
        function toggleChefBot() {
            document.getElementById('chef-bot-modal').classList.toggle('open');
        }

        function toggleAddressField(show) {
            const el = document.getElementById('address-section');
            if (show) el.classList.remove('hidden');
            else el.classList.add('hidden');
        }

        function getLocation() {
            const status = document.getElementById('geo-status');
            const mapsInput = document.getElementById('maps-link');
            if (!navigator.geolocation) { status.innerText = "Geolocaliza√ß√£o n√£o suportada."; return; }
            status.innerText = "Solicitando permiss√£o...";
            const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const link = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
                    mapsInput.value = link;
                    status.innerHTML = `<span class="geo-success"><i class="fas fa-check-circle"></i> Localiza√ß√£o gravada!</span>`;
                },
                (error) => {
                    let msg = "Erro ao obter localiza√ß√£o.";
                    switch(error.code) {
                        case error.PERMISSION_DENIED: msg = "Permiss√£o negada. Ative nas configura√ß√µes."; break;
                        case error.POSITION_UNAVAILABLE: msg = "Sinal de GPS indispon√≠vel."; break;
                        case error.TIMEOUT: msg = "Tempo esgotado. Tente novamente."; break;
                    }
                    status.innerText = msg;
                    document.getElementById('address-text').focus();
                }, options
            );
        }

        function finalizeOrder() {
            const name = document.getElementById('customer-name').value;
            const typeRadio = document.querySelector('input[name="orderType"]:checked');
            const payment = document.getElementById('payment-method').value;
            if (!name) return alert("Por favor, digite seu nome.");
            if (!typeRadio) return alert("Escolha o tipo de pedido.");
            const type = typeRadio.value;
            let addressMsg = "";
            if (type === 'Entrega') {
                const mapsLink = document.getElementById('maps-link').value;
                const addressText = document.getElementById('address-text').value;
                if (!mapsLink && !addressText) return alert("Para entrega, precisamos da localiza√ß√£o GPS ou do endere√ßo escrito.");
                if (mapsLink) addressMsg += `\nüìç *GPS:* ${mapsLink}`;
                if (addressText) addressMsg += `\nüè† *Endere√ßo:* ${addressText}`;
            }
            let msg = `*NOVO PEDIDO - DOG√ÉO PRE√Å*\n----------------------------\n`;
            msg += `üë§ *Cliente:* ${name}\n`;
            msg += `üì¶ *Tipo:* ${type}\n`;
            msg += `üí∞ *Pagamento:* ${payment}\n\n`;
            msg += `*ITENS:*\n`;
            let hasConsultItem = false;
            cart.forEach(item => {
                const priceTxt = item.price > 0 ? `(R$ ${(item.price * item.qty).toFixed(2)})` : "(Consultar)";
                msg += `${item.qty}x ${item.name} ${priceTxt}\n`;
                if(item.price === 0) hasConsultItem = true;
            });
            const total = cart.reduce((acc, i) => acc + (i.price * i.qty), 0);
            msg += `\n*TOTAL ESTIMADO: R$ ${total.toFixed(2).replace('.',',')}*`;
            if(hasConsultItem) msg += `\n‚ö†Ô∏è _Cont√©m itens a consultar valor._`;
            if (addressMsg) {
                msg += `\n\n*LOCAL DE ENTREGA:*${addressMsg}`;
                msg += `\n‚ö†Ô∏è _Taxa de entrega a calcular._`;
            }
            const phone = "5588996768158";
            const url = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        }

        /* --- L√ìGICA DO CHATBOT (REGRAS SIMPLES) --- */
        function handleChatKey(e) { if(e.key === 'Enter') sendMessage(); }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim().toLowerCase();
            const messagesContainer = document.getElementById('chat-messages');

            if (!msg) return;

            // Adiciona mensagem do usu√°rio
            messagesContainer.innerHTML += `<div class="message user">${input.value}</div>`;
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Mostra indicador de digita√ß√£o
            document.getElementById('typing-indicator').style.display = 'block';

            // Simula delay de processamento
            setTimeout(() => {
                let responseText = "";
                
                // L√≥gica de respostas predefinidas
                if (msg.includes('oi') || msg.includes('ol√°') || msg.includes('ola')) {
                    responseText = "Ol√°! üëã Eu sou o Chef Dog√£o. Diz-me o que queres comer hoje! Tenho sandu√≠ches, hot-dogs, past√©is e muito mais!";
                } 
                else if (msg.includes('fome') || msg.includes('grande') || msg.includes('gigante')) {
                    // Sugere os maiores itens
                    const bigItems = menuData.filter(i => i.name.includes('X-Tudo') || i.name.includes('Dog√£o') || i.name.includes('Lanch√£o'));
                    const item = bigItems[Math.floor(Math.random() * bigItems.length)];
                    responseText = `Se a fome √© grande, encara um **${item.name}**! üí™ Custa s√≥ R$ ${item.price.toFixed(2).replace('.',',')}.`;
                }
                else if (msg.includes('bacon')) {
                    const baconItems = menuData.filter(i => i.name.toLowerCase().includes('bacon') || i.desc.toLowerCase().includes('bacon'));
                    const item = baconItems[Math.floor(Math.random() * baconItems.length)];
                    responseText = `Hummm... bacon √© vida! ü•ì Que tal um **${item.name}**? (${item.desc})`;
                }
                else if (msg.includes('frango')) {
                    const chickenItems = menuData.filter(i => i.name.toLowerCase().includes('frango') || i.desc.toLowerCase().includes('frango'));
                    const item = chickenItems[Math.floor(Math.random() * chickenItems.length)];
                    responseText = `Para quem curte frango, o **${item.name}** √© top! üçó`;
                }
                else if (msg.includes('barato') || msg.includes('econ√¥mico') || msg.includes('10')) {
                    const cheapItems = menuData.filter(i => i.price <= 10 && i.price > 0);
                    const item = cheapItems[Math.floor(Math.random() * cheapItems.length)];
                    responseText = `Temos op√ß√µes √≥timas para o bolso! O **${item.name}** sai por apenas R$ ${item.price.toFixed(2).replace('.',',')}. ü§ë`;
                }
                else if (msg.includes('beber') || msg.includes('sede') || msg.includes('refri') || msg.includes('suco')) {
                    responseText = "Para beber temos Sucos Naturais e Refrigerantes (Lata at√© 2L). ü•§ Vai querer um geladinho?";
                }
                else if (msg.includes('pastel') || msg.includes('past√©is')) {
                    responseText = "Os nossos past√©is s√£o fritinhos na hora! Temos de Carne, Queijo, Misto e Frango. ü•ü";
                }
                else if (msg.includes('card√°pio') || msg.includes('menu')) {
                    responseText = "Podes ver todo o card√°pio deslizando a tela! Temos Sandu√≠ches, Hot-dogs, Past√©is e Bebidas. O que te apetece? üòã";
                }
                else {
                    // Resposta gen√©rica sugerindo algo aleat√≥rio
                    const randomItem = menuData[Math.floor(Math.random() * menuData.length)];
                    responseText = `N√£o tenho certeza se entendi, mas aposto que ias adorar um **${randomItem.name}**! üòç`;
                }

                // Adiciona resposta do bot
                messagesContainer.innerHTML += `<div class="message bot">${responseText}</div>`;
                document.getElementById('typing-indicator').style.display = 'none';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

            }, 1000);
        }
    </script>
</body>
</html>
