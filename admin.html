<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - DOGÃO PREÁ</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #ff9f1c;
            --primary-dark: #e08b15;
            --bg-body: #f0f2f5;
            --text-main: #1c1e21;
            --danger: #ff4444;
            --success: #00c851;
        }

        * { box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: var(--bg-body); margin: 0; padding-bottom: 50px; color: var(--text-main); }
        
        .admin-header { background: #fff; padding: 15px 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        h1 { font-family: 'Bebas Neue'; margin: 0; font-size: 24px; color: var(--primary-dark); }
        
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        
        /* Login */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 2000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .login-box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
        
        /* Cards */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Switch */
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* Items */
        .category-header { font-family: 'Bebas Neue'; font-size: 20px; margin: 30px 0 10px; color: #555; border-bottom: 2px solid var(--primary); display: inline-block; }
        .admin-item { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
        /* Estilo para item indisponível na lista */
        .admin-item.unavailable { background-color: #f8f8f8; opacity: 0.7; border-left: 4px solid var(--danger); }
        
        .item-info { flex: 1; }
        .item-name { font-weight: 700; font-size: 16px; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px; }
        .btn-edit { background: #e3f2fd; color: #1976d2; margin-right: 5px; }
        .btn-delete { background: #ffebee; color: #c62828; }
        .btn-add { background: var(--primary); color: #000; width: 100%; padding: 15px; font-size: 16px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(255,159,28,0.3); }
        .btn-restore { background: #2196F3; color: white; width: 100%; padding: 15px; margin-top: 10px; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal.open { display: flex; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        
        .form-input, .form-select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px; margin-bottom: 15px; display: block; }
        .form-label { font-weight: 600; font-size: 13px; color: #666; margin-bottom: 5px; display: block; }
        
        /* Checkbox customizado para disponibilidade */
        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding: 10px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
        .checkbox-wrapper input { width: 20px; height: 20px; margin: 0; cursor: pointer; }
        .checkbox-wrapper label { margin: 0; font-size: 15px; cursor: pointer; color: #333; }
        
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 24px; border-radius: 50px; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 3000; }
        #toast.show { opacity: 1; bottom: 30px; }
    </style>
</head>
<body>

    <!-- Login -->
    <div id="login-overlay">
        <div class="login-box">
            <h2 style="font-family: 'Bebas Neue'; font-size: 32px; color: var(--primary);">Área Restrita</h2>
            <input type="password" id="admin-pass" class="form-input" style="text-align: center;" placeholder="Senha">
            <button class="btn" style="background: var(--primary); width: 100%; padding: 12px;" onclick="checkLogin()">ENTRAR</button>
            <p id="login-error" style="color: var(--danger); font-size: 12px; display: none; margin-top: 10px;">Senha incorreta!</p>
        </div>
    </div>

    <!-- Conteúdo -->
    <div id="app-content" style="display: none;">
        <header class="admin-header">
            <h1>Dogão Admin</h1>
            <button class="btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        </header>

        <div class="container">
            <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0;">Status da Loja</h3>
                    <div id="status-text" style="font-size: 13px; color: #666;">Carregando...</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="store-toggle" onchange="toggleStoreStatus()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="card" style="font-size: 13px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="manual-override" onchange="toggleManualOverride()">
                    <span>Forçar controle manual (ignora horário)</span>
                </label>
            </div>

            <button class="btn btn-add" onclick="openModal()"><i class="fas fa-plus-circle"></i> ADICIONAR NOVO ITEM</button>

            <div id="items-list">
                <p style="text-align: center; margin-top: 40px;">Carregando itens...</p>
            </div>

            <!-- ÁREA DE RESTAURAÇÃO DE DADOS -->
            <div style="margin-top: 50px; border-top: 2px dashed #ddd; padding-top: 20px;">
                <h3 style="color: #666;">⚠️ Ferramentas de Sistema</h3>
                <p style="font-size: 13px; color: #888;">Use isso apenas se o cardápio estiver vazio e você quiser repovoar com os itens padrão.</p>
                <button class="btn btn-restore" onclick="restoreDefaultData()">
                    <i class="fas fa-database"></i> RESTAURAR CARDÁPIO PADRÃO
                </button>
                <p id="restore-status" style="text-align: center; font-size: 12px; margin-top: 10px; color: var(--success);"></p>
            </div>
        </div>
    </div>

    <!-- Modal Form -->
    <div id="item-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top: 0;">Item</h2>
            <input type="hidden" id="edit-id">
            
            <label class="form-label">Nome</label>
            <input type="text" id="edit-name" class="form-input">
            
            <label class="form-label">Preço</label>
            <input type="number" step="0.50" id="edit-price" class="form-input">
            
            <label class="form-label">Categoria</label>
            <select id="edit-category" class="form-select">
                <option value="especiais">Especiais (Favoritos)</option>
                <option value="sanduiches">Sanduíches</option>
                <option value="hotdogs">Hot Dogs</option>
                <option value="pasteis">Pastéis</option>
                <option value="porcoes">Porções</option>
                <option value="bebidas">Bebidas</option>
            </select>
            
            <label class="form-label">Descrição</label>
            <textarea id="edit-desc" rows="3"></textarea>

            <!-- NOVO: Checkbox de Disponibilidade -->
            <div class="checkbox-wrapper">
                <input type="checkbox" id="edit-available" checked>
                <label for="edit-available">Produto Disponível no Cardápio</label>
            </div>

            <div class="form-actions" style="display:flex; justify-content:flex-end; gap:10px;">
                <button class="btn" style="background: #eee;" onclick="closeModal()">Cancelar</button>
                <button class="btn" style="background: var(--primary);" onclick="saveItem()">Salvar</button>
            </div>
        </div>
    </div>

    <div id="toast">Feito!</div>

    <script>
        // --- CONFIGURAÇÃO FIREBASE ---
        const firebaseConfig = {
          apiKey: "AIzaSyClYFGSNXxPmAn3DRWiB7eSxCQ3Nf81IHI",
          authDomain: "dogao-prea.firebaseapp.com",
          projectId: "dogao-prea",
          storageBucket: "dogao-prea.firebasestorage.app",
          messagingSenderId: "126231798500",
          appId: "1:126231798500:web:acbc4e4ef19b14d02082f1",
          measurementId: "G-40QL50Z24D"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const COL_ITEMS = 'menu_items';
        const COL_SETTINGS = 'settings';

        // --- AUTH ---
        function checkLogin() {
            const pass = document.getElementById('admin-pass').value;
            if(pass === 'admin123' || pass === 'dogao') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-content').style.display = 'block';
                auth.signInAnonymously().then(loadData).catch(e => alert("Erro Auth: " + e.message));
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }
        function logout() { location.reload(); }

        // --- DADOS ---
        let currentItems = [];
        function loadData() {
            db.collection(COL_SETTINGS).doc('store').onSnapshot(doc => {
                if(doc.exists) {
                    const d = doc.data();
                    document.getElementById('store-toggle').checked = d.isOpen;
                    document.getElementById('manual-override').checked = d.manualOverride;
                    document.getElementById('status-text').innerText = d.manualOverride ? 
                        (d.isOpen ? "ABERTO (Manual)" : "FECHADO (Manual)") : "Automático";
                    document.getElementById('status-text').style.color = d.manualOverride ? 
                        (d.isOpen ? "var(--success)" : "var(--danger)") : "#666";
                }
            });

            db.collection(COL_ITEMS).orderBy('name').onSnapshot(snap => {
                currentItems = [];
                const list = document.getElementById('items-list');
                list.innerHTML = '';
                snap.forEach(doc => currentItems.push({id: doc.id, ...doc.data()}));
                
                if(currentItems.length === 0) {
                    list.innerHTML = '<p style="text-align:center; padding:20px; color:#999;">O cardápio está vazio.<br>Use o botão abaixo para restaurar os itens.</p>';
                    return;
                }

                // Render
                const categories = {
                    'especiais': 'Favoritos', 'sanduiches': 'Sanduíches', 'hotdogs': 'Hot Dogs',
                    'pasteis': 'Pastéis', 'porcoes': 'Porções', 'bebidas': 'Bebidas'
                };

                Object.keys(categories).forEach(catKey => {
                    const itemsInCat = currentItems.filter(i => i.category === catKey);
                    if(itemsInCat.length > 0) {
                        list.innerHTML += `<div class="category-header">${categories[catKey]}</div>`;
                        
                        itemsInCat.forEach(item => {
                            // Verifica se item.available é false para adicionar classe visual
                            // Se available for undefined (itens antigos), assume true
                            const isUnavailable = item.available === false;
                            const statusLabel = isUnavailable ? '<span style="color:var(--danger); font-weight:700; font-size:12px;">(INDISPONÍVEL)</span>' : '';
                            
                            list.innerHTML += `
                                <div class="admin-item ${isUnavailable ? 'unavailable' : ''}">
                                    <div class="item-info">
                                        <div class="item-name">${item.name} ${statusLabel}</div>
                                        <div style="font-size:12px; color:#666;">${item.desc ? item.desc.substring(0,40) + '...' : ''}</div>
                                    </div>
                                    <div style="text-align:right;">
                                        <div style="font-weight:bold; color:var(--primary-dark);">R$ ${item.price.toFixed(2)}</div>
                                        <div style="margin-top:5px;">
                                            <button class="btn btn-edit" onclick="openModal('${item.id}')"><i class="fas fa-edit"></i></button>
                                            <button class="btn btn-delete" onclick="deleteItem('${item.id}')"><i class="fas fa-trash"></i></button>
                                        </div>
                                    </div>
                                </div>`;
                        });
                    }
                });
            });
        }

        // --- CRUD ---
        function openModal(id = null) {
            const modal = document.getElementById('item-modal');
            const item = id ? currentItems.find(i => i.id === id) : {name:'', price:'', category:'sanduiches', desc:'', available: true};
            document.getElementById('modal-title').innerText = id ? 'Editar' : 'Novo';
            document.getElementById('edit-id').value = id || '';
            document.getElementById('edit-name').value = item.name;
            document.getElementById('edit-price').value = item.price;
            document.getElementById('edit-category').value = item.category;
            document.getElementById('edit-desc').value = item.desc;
            // Se available for undefined, assume true
            document.getElementById('edit-available').checked = item.available !== false; 
            modal.classList.add('open');
        }
        function closeModal() { document.getElementById('item-modal').classList.remove('open'); }

        function saveItem() {
            const id = document.getElementById('edit-id').value;
            const data = {
                name: document.getElementById('edit-name').value,
                price: parseFloat(document.getElementById('edit-price').value) || 0,
                category: document.getElementById('edit-category').value,
                desc: document.getElementById('edit-desc').value,
                available: document.getElementById('edit-available').checked // Salva o status
            };
            if(!data.name) return alert("Nome obrigatório");
            
            const p = id ? db.collection(COL_ITEMS).doc(id).update(data) : db.collection(COL_ITEMS).add(data);
            p.then(() => { closeModal(); showToast(); });
        }

        function deleteItem(id) {
            if(confirm("Apagar?")) db.collection(COL_ITEMS).doc(id).delete().then(showToast);
        }

        function toggleStoreStatus() {
            db.collection(COL_SETTINGS).doc('store').set({ isOpen: document.getElementById('store-toggle').checked }, {merge:true});
        }
        function toggleManualOverride() {
            db.collection(COL_SETTINGS).doc('store').set({ manualOverride: document.getElementById('manual-override').checked }, {merge:true});
        }
        
        function showToast() {
            const t = document.getElementById('toast');
            t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000);
        }

        // --- RESTAURAÇÃO DE DADOS ---
        function restoreDefaultData() {
            if(!confirm("Isso vai adicionar os itens padrão. Continuar?")) return;
            const btn = document.querySelector('.btn-restore');
            btn.disabled = true; btn.innerText = "Restaurando...";
            
            // Backup items (com available: true por padrão)
            const backupItems = [
                { name: "Dogão Especial", price: 12.00, category: "hotdogs", desc: "Pão, 2 salsichas, carne moída, milho, ervilha, batata palha e molhos especiais.", available: true },
                { name: "X-Tudo", price: 18.00, category: "especiais", desc: "Pão, hambúrguer, ovo, bacon, presunto, queijo, salsicha, alface e tomate.", available: true },
                { name: "Coca-Cola Lata", price: 5.00, category: "bebidas", desc: "350ml, bem gelada.", available: true }
            ];

            let count = 0;
            const status = document.getElementById('restore-status');
            backupItems.forEach((item, index) => {
                setTimeout(() => {
                    db.collection(COL_ITEMS).add(item).then(() => {
                          count++; status.innerText = `Restaurado ${count}/${backupItems.length}`;
                          if(count === backupItems.length) { status.innerText = "Concluído!"; btn.disabled = false; btn.innerText = "Restaurar"; }
                      });
                }, index * 200);
            });
        }
    </script>
</body>
</html>
